<!DOCTYPE html>
<head>
  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <!-- <script src="js/bootstrap.min.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
</head>

<body>
  <div class="container" ng-app="app">
    <div id="chart-body">
      <div id="chart-container">
         <!-- izveido vēlvienu + chart-container priekš katra chart-->
        <canvas id="GZG070-1"></canvas>
      </div>
      <div id="chart-container">
        <!-- izveido vēlvienu + chart-container priekš katra chart-->
        <canvas id="ISG010-1"></canvas>
      </div>
    </div>
  </div>
</body>

<script>

const charts = [
  // Pievieno šeit lai izveidotu jaunus grafikus.
  {
    id: 'GZG070-1',   // canvas elementa id (izveidot jaunu, priekš jauna chart)
    source: 'GZG070', // faila vārds uz ./data folder, serverī
    type: 'bar',      // veids citi: chartjs.org
    amount: 10,       // cik daudz datus izmantot (no augšas)
    data: [{
      label: 'Faktiski',     // virsraksts
      primaryKey: 'FAKTISKI' // "atslēga" no csv faila kollonas nosaukuma
    }, {
      label: 'Norma',
      primaryKey: 'NORMA'
    }]
  }, {
    id: 'ISG010-1',
    source: 'ISG010',
    type: 'line',
    amount: 50,
    from: 51,      // no kurienes
    data: [{
      label: 'Iedzīvotāju skaits gada sākumā',
      primaryKey: 'Iedzīvotāju skaits gada sākumā'
    }]
  }
]

charts.forEach(chart => {
  const req = new XMLHttpRequest();
  req.open('GET', 'http://localhost:8081/chart/' + chart.source);
  req.onload = () => {
    let data = JSON.parse(req.response);

    if (chart.amount > 0)
      data = data.slice(chart.from || 0, chart.amount + (chart.from || 0));

    const _ = new Chart(
      document.getElementById(chart.id).getContext('2d'), {
      type: chart.type,
      data: {
        labels: data.map(x => x[Object.keys(x)[0]]),
        datasets: chart.data.map(a => {
          return {
            label: a.label,
            data: data.map(x => parseInt(x[a.primaryKey]))
          }
        })
      }
    });
  }
  req.send();
});

</script>
</html>
